<!DOCTYPE html>
<html>

<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <title>Sebastian Dengler</title>
   <meta name="description" content="">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="css/bootstrap.min.css">
   <link rel="stylesheet" href="css/bootstrap-theme.min.css">
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css" rel="stylesheet">
   <link rel="stylesheet" href="css/light-box.css">
   <link rel="stylesheet" href="css/templatemo-style.css">
   <link
      href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900italic,900'
      rel='stylesheet'>
   <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
   <script src="https://www.gstatic.com/charts/loader.js"></script>
   <script>
      function sendRequest(hours) {
         var url = "<API_URL>iot-query-dynamodb-lambda";

         var xhr = new XMLHttpRequest();
         xhr.open("POST", url, false);

         xhr.setRequestHeader("Accept", "application/json");
         xhr.setRequestHeader("Content-Type", "application/json");

         xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
               console.log(xhr.status);
            }
         };

         var to = parseInt(Date.now() / 1000);
         var from = to - 3600 * hours;

         var data = `{
            "from": ${from},
            "to": ${to}
            }`;

         xhr.send(data)
         return JSON.parse(xhr.response);
      }

      var range = null;
      var myResponse = null;

      google.charts.load('current', { packages: ['corechart', 'line'] });

      window.addEventListener('resize', function () { drawBasic(range) });

      function drawBasic(hours = 48) {

         var data = new google.visualization.DataTable();
         data.addColumn('datetime', 'Time');
         data.addColumn('number', 'Temperature');
         data.addColumn('number', 'Humidity');

         if (range != hours) {
            myResponse = sendRequest(hours);
            console.log(myResponse)
            document.getElementById("p1").innerHTML = "Humidity: " + myResponse.data[myResponse.data.length - 1][2] + " %";
            document.getElementById("p2").innerHTML = "Temperature: " + Math.round(myResponse.data[myResponse.data.length - 1][1]) + " °C";
            range = hours;
         }

         for (let i = 0; i < myResponse.data.length; i++) {
            data.addRow([new Date(myResponse.data[i][0] * 1000), myResponse.data[i][1], myResponse.data[i][2]])
            //data.addRow([new Date(myResponse.timestamp[i]*1000), myResponse.temperature[i], myResponse.humidity[i]]);
         }

         var options = {
            backgroundColor: '#232323',
            curveType: 'function',
            colors: ['red', 'blue'],
            width: window.innerWidth,
            height: .45 * window.innerWidth,
            textStyle: {
               color: '#909090'
            },
            legend: {
               textStyle: {
                  color: '#909090'
               }
            },
            series: {
               0: { targetAxisIndex: 0 },
               1: { targetAxisIndex: 1 }
            },
            hAxis: {
               title: 'Time',
               titleColor: '#909090',
               color: '#909090',
               textStyle: {
                  color: '#909090'
               }
            },
            vAxes: {
               0: {
                  title: 'Temperature in °C',
                  titleColor: '#909090',
                  color: '#909090',
                  gridlines: {
                     multiple: 5,
                  },
                  viewWindow: {
                     min: 10,
                     max: 30
                  },
                  textStyle: {
                     color: '#909090'
                  }
               },
               1: {
                  title: 'Humidity in %',
                  titleColor: '#909090',
                  color: '#909090',
                  gridlines: {
                     multiple: 25,
                  },
                  viewWindow: {
                     min: 0,
                     max: 100
                  },
                  textStyle: {
                     color: '#909090'
                  }
               }
            }
         };

         var chart = new google.visualization.AreaChart(document.getElementById('point'));
         chart.draw(data, options);
      }

      google.charts.setOnLoadCallback(drawBasic);
   </script>
</head>

<body>
   <nav>
      <div class="logo">
         <a href="index.html"><em>IoT</em></a>
      </div>
      <div class="menu-icon">
         <span></span>
      </div>
   </nav>
   <div class="graph-item" id="point"></div>
   <div class="graph-buttons">
      <button type="button" onclick="drawBasic(12)">12h</button>
      <button type="button" onclick="drawBasic(24)">1d</button>
      <button type="button" onclick="drawBasic(48)">2d</button>
      <button type="button" onclick="drawBasic(168)">7d</button>
   </div>
   </div>
   <div class="services" style="padding: 0px;">
      <div class="container">
         <div class="row">
            <div class="service-item">
               <i class="fas fa-tint" style="color:rgb(56, 56, 209); font-size:40px;"></i>
               <div class="text">
                  <p id="p1"></p>
               </div>
               <i class="fas fa-thermometer-half" style="color: rgb(175, 44, 44); font-size:40px;"></i>
               <div class="text">
                  <p id="p2"></p>
               </div>
            </div>
         </div>
      </div>
   </div>
   <footer>
      <div class="container-fluid">
         <div class="col-md-12">
            <p>Copyright &copy; 2021 Sebastian Dengler</p>
         </div>
      </div>
   </footer>
   <section class="overlay-menu">
      <div class="container">
         <div class="row">
            <div class="main-menu">
               <ul>
                  <li>
                     <a href="index.html">Home</a>
                  </li>
                  <li>
                     <a href="iot.html">IoT</a>
                  </li>
                  <li>
                     <a href="about.html">About</a>
                  </li>
               </ul>
               <p>My minimalistic webpage.</p>
            </div>
         </div>
      </div>
   </section>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
   <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.min.js"><\/script>')</script>
   <script src="js/vendor/bootstrap.min.js"></script>
   <script src="js/plugins.js"></script>
   <script src="js/main.js"></script>
</body>

</html>